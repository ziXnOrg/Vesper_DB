# Vesper Repository Cleanup Proposal

**Date:** 2025-10-19  
**Objective:** Improve repository organization, remove build artifacts, consolidate documentation, and ensure production-grade cleanliness.

---

## Executive Summary

This proposal identifies 12 build directories, 5 orphaned test files, 4 stray generated files, and several organizational issues that should be addressed to maintain a production-grade repository.

**Impact:** Low risk (mostly build artifacts and temporary files)  
**Effort:** 30-60 minutes  
**Reversibility:** High (all changes can be undone via git)

---

## Critical Issues (High Priority)

### 1. Multiple Build Directories (12 total)

**Problem:** Build directories tracked in repository (should be in `.gitignore`)

**Directories to remove:**
- `build/` (main build directory)
- `build-capq/`
- `build-clang/`
- `build-clang-ninja/`
- `build-clangcl-ninja/`
- `build-clangcl-rel/`
- `build-fuzz/`
- `build-msvc/`
- `build-msvc-blas/`
- `build-off/`
- `build-release/`
- `build-relwithdebinfo/`
- `build-test/`

**Action:**
```bash
# Remove all build directories
rm -rf build build-* out/build

# Ensure .gitignore contains:
# build/
# build-*/
# out/
```

**Rationale:**
- Build artifacts should never be tracked in version control
- Each developer/CI should generate their own build directories
- Reduces repository size significantly

**Risk:** None (build directories are regenerated by CMake)

---

### 2. Orphaned Test Files in Root

**Problem:** Test files in root directory (should be in `/tests/`)

**Files to move:**
- `test_advanced_features.cpp` → `tests/integration/`
- `test_index_manager.cpp` → `tests/integration/`
- `test_performance_enhancements.cpp` → `tests/integration/`

**Action:**
```bash
mv test_advanced_features.cpp tests/integration/
mv test_index_manager.cpp tests/integration/
mv test_performance_enhancements.cpp tests/integration/
```

**Rationale:**
- Consistent test organization
- Easier to discover and run tests
- Follows project structure conventions

**Risk:** Low (may need to update CMakeLists.txt if these are referenced)

---

### 3. Stray Generated Files in Root

**Problem:** Generated/temporary files in root directory

**Files to remove:**
- `nul` (Windows null device artifact)
- `{out_json}` (malformed output file)
- `vesper_test_index.bin/` (test artifact directory)
- `Testing/` (CTest artifact directory)

**Action:**
```bash
rm -f nul {out_json}
rm -rf vesper_test_index.bin Testing
```

**Rationale:**
- These are build/test artifacts
- Should be in build directory or `.gitignore`
- Pollute root directory

**Risk:** None (regenerated by tests)

---

### 4. Duplicate/Stray Source Files in Root

**Problem:** Source files with malformed paths in root

**Files to remove:**
- `CUsersciscoDesktopdevresearchVespersrcindexmatryoshka.cpp`
- `CUsersciscoDesktopdevresearchVespersrcioasync_io.cpp`

**Action:**
```bash
rm -f CUsersciscoDesktopdevresearchVespersrcindexmatryoshka.cpp
rm -f CUsersciscoDesktopdevresearchVespersrcioasync_io.cpp
```

**Rationale:**
- These appear to be accidentally created files with malformed paths
- Actual source files are in `src/index/matryoshka.cpp` and `src/io/async_io.cpp`
- No valid reason for these to exist

**Risk:** None (duplicates of existing files)

---

### 5. Research_prompt.md in Root

**Problem:** Research prompt file in root (temporary artifact from AI agent orchestration task)

**Options:**
1. **Remove** (recommended if task complete)
2. **Move to docs/** (if keeping for reference)
3. **Move to .augment/** (if part of AI assistant context)

**Action (recommended):**
```bash
rm Research_prompt.md
```

**Rationale:**
- This was a temporary file created for a standalone task (ziX Labs AI agent orchestration framework)
- Not part of Vesper project
- Can be recreated if needed

**Risk:** None (standalone artifact, not referenced by project)

---

## Moderate Issues (Medium Priority)

### 6. Fuzz Corpus Directories Scattered in Root

**Problem:** Fuzz corpus directories in root (should be in `/tests/fuzz/corpus/` or `.gitignore`)

**Directories:**
- `ivfpq_badshash_dir/`
- `ivfpq_flip_dir/`
- `ivfpq_fuzz_good/`
- `ivfpq_trunc_dir/`
- `fuzz-corpus/`

**Options:**
1. **Move to `/tests/fuzz/corpus/`** (if needed for CI)
2. **Remove and add to `.gitignore`** (if generated by fuzz tests)

**Action (recommended):**
```bash
# Option 2: Remove and ignore (fuzz tests regenerate corpus)
rm -rf ivfpq_badshash_dir ivfpq_flip_dir ivfpq_fuzz_good ivfpq_trunc_dir fuzz-corpus

# Add to .gitignore:
# *_dir/
# fuzz-corpus/
```

**Rationale:**
- Fuzz corpus is typically generated by fuzz tests
- Large corpus files bloat repository
- CI can regenerate corpus as needed

**Risk:** Low (fuzz tests regenerate corpus; may need to seed initial corpus)

---

### 7. Testing Directory in Root

**Problem:** `Testing/` directory in root (CTest artifact)

**Action:**
```bash
rm -rf Testing

# Ensure .gitignore contains:
# Testing/
```

**Rationale:**
- CTest generates this directory in build directory
- Should not be in root
- Regenerated by CTest

**Risk:** None (CTest artifact)

---

### 8. Experimental/Experiments Directories Overlap

**Problem:** Both `/experimental/` and `/experiments/` exist with similar purposes

**Current state:**
- `/experimental/` — Contains `hnsw_lockfree.cpp/hpp` (experimental HNSW variant)
- `/experiments/` — Contains `VALIDATION.md`, `examples/`, `schema/`

**Options:**
1. **Consolidate into `/experimental/`** (recommended)
2. **Keep separate** (if distinct purposes)

**Action (recommended):**
```bash
# Move experiments/ contents to experimental/
mv experiments/VALIDATION.md experimental/
mv experiments/examples experimental/
mv experiments/schema experimental/
rmdir experiments
```

**Rationale:**
- Single directory for experimental code
- Clearer organization
- Reduces confusion

**Risk:** Low (may need to update references in documentation)

---

### 9. Duplicate Documentation

**Problem:** `docs/CODING_STANDARDS.md` duplicates root `CODING_STANDARDS.md`

**Current state:**
- Root `CODING_STANDARDS.md` — 78 lines, Vesper-specific
- `docs/CODING_STANDARDS.md` — Unknown (need to check)

**Action (after verification):**
```bash
# If identical, remove docs/ version and keep root
rm docs/CODING_STANDARDS.md

# OR if docs/ version is more comprehensive, keep it and remove root
# (Need to verify content first)
```

**Rationale:**
- Single source of truth for coding standards
- Avoid divergence between copies

**Risk:** Low (need to verify which is authoritative)

---

## Minor Issues (Low Priority)

### 10. Scripts in Root Directory

**Problem:** Utility scripts in root (should be in `/scripts/`)

**Files to move:**
- `rebuild.bat` → `scripts/`
- `fix_unexpected.py` → `scripts/`
- `test_remote.sh` → `scripts/`

**Action:**
```bash
mv rebuild.bat scripts/
mv fix_unexpected.py scripts/
mv test_remote.sh scripts/
```

**Rationale:**
- Consistent script organization
- Cleaner root directory

**Risk:** Low (may need to update documentation referencing these scripts)

---

## .gitignore Additions

**Add to `.gitignore`:**
```gitignore
# Build directories
build/
build-*/
out/

# Test artifacts
Testing/
vesper_test_index.bin/
*_test_index.bin/

# Fuzz corpus
fuzz-corpus/
*_dir/

# Generated files
nul
{out_json}

# Platform-specific
*.user
*.suo
*.sln.docstates
```

---

## Execution Plan

### Phase 1: Safe Removals (No Risk)
1. Remove all build directories
2. Remove stray generated files (nul, {out_json}, Testing/)
3. Remove duplicate source files with malformed paths
4. Remove Research_prompt.md (if task complete)

### Phase 2: Organizational Moves (Low Risk)
5. Move orphaned test files to `/tests/integration/`
6. Move scripts to `/scripts/`
7. Consolidate experimental directories

### Phase 3: Verification Required (Medium Risk)
8. Verify and remove duplicate documentation
9. Decide on fuzz corpus handling (remove or move)

### Phase 4: .gitignore Updates
10. Update `.gitignore` with all patterns

---

## Validation Checklist

**Before cleanup:**
- [ ] Verify no uncommitted changes in build directories
- [ ] Verify test files are not referenced in CMakeLists.txt
- [ ] Verify scripts are not referenced in CI/documentation

**After cleanup:**
- [ ] CMake configure succeeds
- [ ] All tests build and pass
- [ ] CI pipeline succeeds
- [ ] Documentation links are valid

---

## Rollback Plan

**If issues arise:**
```bash
# Restore from git (if changes committed)
git reset --hard HEAD~1

# Restore specific files
git checkout HEAD -- <file_path>
```

---

## Approval Required

**Please review and approve before execution:**
- [ ] Phase 1: Safe Removals
- [ ] Phase 2: Organizational Moves
- [ ] Phase 3: Verification Required
- [ ] Phase 4: .gitignore Updates

**Questions to confirm:**
1. Is `Research_prompt.md` still needed? (Recommend: Remove)
2. Should fuzz corpus be tracked or ignored? (Recommend: Ignore)
3. Which `CODING_STANDARDS.md` is authoritative? (Need to verify)
4. Are orphaned test files still used? (Need to check CMakeLists.txt)

---

## Next Steps

1. **User reviews this proposal**
2. **User approves specific phases**
3. **Execute approved phases**
4. **Validate changes (CMake, tests, CI)**
5. **Commit cleanup with detailed message**

